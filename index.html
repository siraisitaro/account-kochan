<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gospel Quest: Noah's Logic</title>
    <style>
        /* ãƒã‚¢ç‰§å¸«ä»•æ§˜ã®ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆç”»åƒå¯¾å¿œç‰ˆï¼‰ */
        body { background-color: #1a1a2e; color: #e0e0e0; font-family: 'Courier New', monospace; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #game-container { position: relative; width: 100%; max-width: 480px; height: 100%; max-height: 800px; background: #16213e; border: 2px solid #0f3460; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        /* 1. ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ‘ãƒ¼ãƒˆ */
        #story-screen { flex: 1; display: flex; flex-direction: column; padding: 20px; background: #1a1a2e; }
        
        /* ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
        #scene-image { 
            width: 100%; 
            height: 240px; /* å°‘ã—ç¸¦é•·ã« */
            background: #000; 
            margin-bottom: 15px; 
            border: 2px solid #533483; 
            overflow: hidden; /* ã¯ã¿å‡ºã—é˜²æ­¢ */
            position: relative;
        }
        /* ä¸­ã®ç”»åƒãŒè‰¯ã„æ„Ÿã˜ã«åã¾ã‚‹ã‚ˆã†ã«ã™ã‚‹ */
        #scene-image img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* æ ã«åˆã‚ã›ã¦ãƒˆãƒªãƒŸãƒ³ã‚°è¡¨ç¤º */
            display: block;
        }
        /* ç”»åƒãŒãªã„æ™‚ã®ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆç”¨ */
        .placeholder-text {
            width: 100%; height: 100%; display: flex; 
            justify-content: center; align-items: center; 
            color: #555; text-align: center; padding: 10px; box-sizing: border-box;
        }
        
        #text-box { flex: 1; border: 2px solid #e94560; border-radius: 5px; padding: 15px; margin-bottom: 15px; background: rgba(0,0,0,0.6); font-size: 15px; line-height: 1.7; overflow-y: auto; color: #fff; }
        .name-tag { color: #e94560; font-weight: bold; margin-bottom: 5px; display: block; }
        
        #action-btn { padding: 15px; background: #0f3460; color: #00d4ff; border: 1px solid #00d4ff; font-weight: bold; font-size: 16px; cursor: pointer; transition: all 0.2s; }
        #action-btn:active { background: #00d4ff; color: #0f3460; }

        /* 2. ãƒãƒˆãƒ«ãƒ‘ãƒ¼ãƒˆ */
        #battle-screen { display: none; width: 100%; height: 100%; position: relative; background: #000; }
        canvas { display: block; width: 100%; height: 100%; }
        #battle-ui { position: absolute; top: 10px; left: 10px; color: white; pointer-events: none; text-shadow: 1px 1px 0 #000; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="story-screen">
        <div id="scene-image"><!-- ã“ã“ã«ç”»åƒãŒå…¥ã‚Šã¾ã™ --></div>
        <div id="text-box">
            <span class="name-tag">ã‚·ã‚¹ãƒ†ãƒ </span>
            èª­ã¿è¾¼ã¿ä¸­...
        </div>
        <button id="action-btn" onclick="nextScript()">â–¼ æ¬¡ã¸</button>
    </div>

    <div id="battle-screen">
        <div id="battle-ui">Target: <span id="target-name">Enemy</span></div>
        <canvas id="gameCanvas"></canvas>
    </div>
</div>

<script>
    // --- ğŸ‘“ ãƒã‚¢ç‰§å¸«ã®ç‰©èªãƒ‡ãƒ¼ã‚¿ ---
    // ã€é‡è¦ã€‘ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«å(img)ã¯ã€GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‚ã®ã«åˆã‚ã›ã¦æ›¸ãæ›ãˆã¦ãã ã•ã„
    const scenario = [
        { 
            id: 0, type: "story", 
            speaker: "ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
            text: "åŒ—æ±åŒ—ã®åœ°æ–¹éƒ½å¸‚ã€æ£®å²¡ã‚·ãƒ†ã‚£ã€‚\nå²©æ‰‹å±±ã®å†·ãŸã„é¢¨ãŒå¹ãè’ã‚Œã‚‹ã“ã®è¡—ã®ç‰‡éš…ã«ã€å¤ã³ãŸãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒˆæ•™ä¼šãŒã‚ã£ãŸã€‚", 
            img: "bg_city.png" 
        },
        { 
            id: 1, type: "story", 
            speaker: "ãƒã‚¢ç‰§å¸«",
            text: "ã€Œã“ã“ãŒâ€¦â€¦ã¿ãªã¿ãƒãƒ£ãƒ¼ãƒã§ã™ã‹ã€‚æ€ã£ãŸã‚ˆã‚Šå»ºç‰©ã®è€æœ½åŒ–ãŒé€²ã‚“ã§ã„ã¾ã™ã­ã€\n\nçœ¼é¡ã®å¥¥ã®ç³ãŒã€å†·é™ã«å»ºç‰©ã®æ§‹é€ çš„æ¬ é™¥ã¨éœŠçš„ãªæ·€ã¿ã‚’åˆ†æã™ã‚‹ã€‚", 
            img: "noah_stand.png" 
        },
        { 
            id: 2, type: "story", 
            speaker: "æ•™ä¼šå½¹å“¡",
            text: "ã€Œãƒã‚¢å…ˆç”Ÿï¼ ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã—ãŸï¼\nå®Ÿã¯æœ€è¿‘ã€æ•™ä¼šã®å‘¨ã‚Šã«ã€ç¾Šã®çš®ã‚’è¢«ã£ãŸç‹¼ã€ãŒå‡ºæ²¡ã—ã¦ã€ä¿¡å¾’ã‚’æƒ‘ã‚ã›ã¦ã„ã‚‹ã‚“ã§ã™ï¼ã€", 
            img: "npc_officer.png" 
        },
        { 
            id: 3, type: "story", 
            speaker: "ãƒã‚¢ç‰§å¸«",
            text: "ï¼ˆçœ¼é¡ã‚’ã‚¯ã‚¤ãƒƒã¨æŠ¼ã—ä¸Šã’ã‚‹ï¼‰\nã€Œãªã‚‹ã»ã©ã€‚å…¸å‹çš„ãªç•°ç«¯ã®æ‰‹å£ã§ã™ã­ã€‚\nè«–ç†çš„æ•´åˆæ€§ã®ãªã„æ•™ç†ã§ä¸å®‰ã‚’ç…½ã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã€‚\n\nâ€¦â€¦è¡Œãã¾ã—ã‚‡ã†ã€‚ç§ãŒã€è–æ›¸çš„ãƒ­ã‚¸ãƒƒã‚¯ã€ã§è§£ä½“ã—ã¾ã™ã€", 
            img: "noah_logic.png" 
        },
        { 
            id: 4, type: "battle", 
            speaker: "ã‚·ã‚¹ãƒ†ãƒ ",
            text: "ï¼ï¼è«–æˆ¦é–‹å§‹ï¼ï¼\nã€ç•°ç«¯ã®ç‹¼ã€‘ãŒç¾ã‚ŒãŸï¼\n\nãƒã‚¢ã€Œãã®è§£é‡ˆã¯æ–‡è„ˆã‚’ç„¡è¦–ã—ã¦ã„ã¾ã™ï¼ã€", 
            enemyName: "ç•°ç«¯ã®ç‹¼", difficulty: 1,
            // ãƒãƒˆãƒ«å‰ã®ç”»åƒã‚‚æŒ‡å®šå¯èƒ½
            img: "enemy_wolf.png"
        },
        { 
            id: 5, type: "story", 
            speaker: "ãƒã‚¢ç‰§å¸«",
            text: "ã€Œâ€¦â€¦ä»¥ä¸Šã®ç†ç”±ã«ã‚ˆã‚Šã€ã‚ãªãŸã®ä¸»å¼µã¯è–æ›¸çš„æ ¹æ‹ ã‚’æ¬ ã„ã¦ã„ã¾ã™ã€‚Q.E.D.ï¼ˆè¨¼æ˜çµ‚äº†ï¼‰ã€", 
            img: "noah_logic.png" 
        },
        { 
            id: 6, type: "story", 
            speaker: "ç•°ç«¯ã®ç‹¼",
            text: "ã€Œãã¬ã¬â€¦â€¦ãªã‚“ã¦ç†è·¯æ•´ç„¶ã¨ã—ãŸåè«–ãªã‚“ã â€¦â€¦ï¼ã€\n\nç‹¼ã¯æ‚”ã„æ”¹ã‚ã€å°»å°¾ã‚’å·»ã„ã¦é€ƒã’ã¦ã„ã£ãŸã€‚", 
            img: "enemy_wolf.png" 
        },
        { 
            id: 7, type: "story", 
            speaker: "ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
            text: "ã“ã†ã—ã¦ã€ã¿ãªã¿ãƒãƒ£ãƒ¼ãƒã«ä¸€æ™‚ã®å¹³å’ŒãŒè¨ªã‚ŒãŸã€‚\nã ãŒã€ã“ã‚Œã¯æ£®å²¡ã‚·ãƒ†ã‚£ã‚’è¦†ã†å·¨å¤§ãªé—‡ã®ã€ã»ã‚“ã®å…¥ã‚Šå£ã«éããªã‹ã£ãŸâ€¦â€¦ã€‚\n\nï¼ˆã¤ã¥ãï¼‰", 
            img: "bg_city.png" 
        }
    ];

    let currentStep = 0;
    const textBox = document.getElementById("text-box");
    const sceneImg = document.getElementById("scene-image");
    const storyScreen = document.getElementById("story-screen");
    const battleScreen = document.getElementById("battle-screen");
    const targetNameSpan = document.getElementById("target-name");

    // --- ç”»åƒã‚’å®‰å…¨ã«è¡¨ç¤ºã™ã‚‹é–¢æ•° ---
    function showImage(filename) {
        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã€ã¾ãŸã¯ç©ºã®å ´åˆã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¡¨ç¤º
        if (!filename || filename.startsWith("[")) {
            sceneImg.innerHTML = `<div class="placeholder-text">${filename || 'No Image'}</div>`;
        } else {
            // ç”»åƒã‚¿ã‚°ã‚’ç”Ÿæˆã—ã¦åŸ‹ã‚è¾¼ã‚€
            sceneImg.innerHTML = `<img src="${filename}" alt="Scene Image" onerror="this.parentElement.innerHTML='<div class=\\'placeholder-text\\'>ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:<br>${filename}</div>'">`;
        }
    }

    // --- ã‚·ãƒŠãƒªã‚ªé€²è¡Œ ---
    function nextScript() {
        if (currentStep >= scenario.length) return;

        const data = scenario[currentStep];

        if (data.type === "story") {
            // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ‘ãƒ¼ãƒˆè¡¨ç¤º
            textBox.innerHTML = `<span class="name-tag">${data.speaker}</span>${data.text.replace(/\n/g, '<br>')}`;
            showImage(data.img); // ç”»åƒè¡¨ç¤ºé–¢æ•°ã‚’å‘¼ã³å‡ºã™
            document.getElementById("action-btn").innerText = "â–¼ æ¬¡ã¸";
            currentStep++;
        } else if (data.type === "battle") {
            // ãƒãƒˆãƒ«å‰è¡¨ç¤º
            textBox.innerHTML = `<span class="name-tag">${data.speaker}</span>${data.text.replace(/\n/g, '<br>')}`;
            showImage(data.img);
            
            const btn = document.getElementById("action-btn");
            btn.innerText = "âš”ï¸ è«–æˆ¦é–‹å§‹ï¼ˆãƒ­ã‚¸ã‚«ãƒ«ãƒ»ãƒ–ãƒ¬ã‚¤ã‚¯ï¼‰";
            
            btn.onclick = () => {
                startBattle(data.difficulty, data.enemyName);
                btn.onclick = nextScript; 
            };
        }
    }

    // --- âœï¸ ãƒ­ã‚¸ã‚«ãƒ«ãƒ»ãƒ–ãƒ­ãƒƒã‚¯å´©ã—ã‚·ã‚¹ãƒ†ãƒ  ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let gameLoopId;
    let ball, paddle, bricks;
    let score = 0, requiredScore = 0;

    function startBattle(difficulty, enemyName) {
        storyScreen.classList.add("hidden");
        battleScreen.style.display = "block";
        targetNameSpan.innerText = enemyName;
        canvas.width = battleScreen.clientWidth;
        canvas.height = battleScreen.clientHeight;
        initGameObjects(difficulty);
        gameLoop();
    }

    function initGameObjects(difficulty) {
        paddle = { x: canvas.width/2 - 50, y: canvas.height - 40, w: 100, h: 10 };
        ball = { x: canvas.width/2, y: canvas.height - 60, dx: 4, dy: -4 - difficulty, r: 6 };
        bricks = [];
        const rows = 4 + difficulty;
        const cols = 5;
        const padding = 8;
        const width = (canvas.width - (padding * (cols + 1))) / cols;
        for(let c=0; c<cols; c++) {
            bricks[c] = [];
            for(let r=0; r<rows; r++) {
                bricks[c][r] = { x: c*(width+padding)+padding, y: r*(20+padding)+50, w: width, h: 20, status: 1 };
            }
        }
        requiredScore = rows * cols;
        score = 0;
    }

    function gameLoop() {
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawBricks();
        drawPaddle();
        drawBall();
        collisionDetection();
        
        if(ball.x + ball.dx > canvas.width - ball.r || ball.x + ball.dx < ball.r) ball.dx = -ball.dx;
        if(ball.y + ball.dy < ball.r) ball.dy = -ball.dy;
        
        if(ball.y + ball.dy > canvas.height - ball.r - 30) {
            if(ball.x > paddle.x && ball.x < paddle.x + paddle.w) {
                ball.dy = -ball.dy;
                let hitPoint = (ball.x - (paddle.x + paddle.w/2)) / (paddle.w/2);
                ball.dx = hitPoint * 8;
            } else if (ball.y + ball.dy > canvas.height) {
                ball.dy = -ball.dy; 
            }
        }
        ball.x += ball.dx;
        ball.y += ball.dy;
        canvas.ontouchmove = (e) => {
            e.preventDefault();
            let relativeX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
            if(relativeX > 0 && relativeX < canvas.width) paddle.x = relativeX - paddle.w/2;
        };
        if(score < requiredScore) {
            gameLoopId = requestAnimationFrame(gameLoop);
        } else {
            endBattle();
        }
    }

    function drawPaddle() {
        ctx.fillStyle = "#00d4ff";
        ctx.shadowBlur = 10;
        ctx.shadowColor = "#00d4ff";
        ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);
        ctx.shadowBlur = 0;
    }
    function drawBall() {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.closePath();
    }
    function drawBricks() {
        bricks.forEach(col => col.forEach(b => {
            if(b.status === 1) {
                ctx.fillStyle = "#e94560"; 
                ctx.fillRect(b.x, b.y, b.w, b.h);
            }
        }));
    }
    function collisionDetection() {
        bricks.forEach(col => col.forEach(b => {
            if(b.status === 1) {
                if(ball.x > b.x && ball.x < b.x+b.w && ball.y > b.y && ball.y < b.y+b.h) {
                    ball.dy = -ball.dy;
                    b.status = 0;
                    score++;
                }
            }
        }));
    }
    function endBattle() {
        cancelAnimationFrame(gameLoopId);
        battleScreen.style.display = "none";
        storyScreen.classList.remove("hidden");
        currentStep++; 
        nextScript();
    }
    nextScript();
</script>
</body>
</html>

